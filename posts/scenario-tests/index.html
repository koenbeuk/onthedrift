<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Introducing ScenarioTests, an experiment in improving the .NET testing experience - On The Drift</title>
<meta name=description content="When developing software, you&rsquo;ll sooner or later be confronted with the notion of Tests. In the .NET landscape we have plenty of tools at our disposal to help us test our code. In this post I&rsquo;d like to introduce ScenarioTests. A new project that aims to make testing in .NET better.">
<meta name=author content="Koen"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"On The Drift","url":"https:\/\/www.onthedrift.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.onthedrift.com"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.onthedrift.com","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.onthedrift.com\/posts\/scenario-tests\/","name":"Introducing scenario tests, an experiment in improving the . net testing experience"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Koen"},"headline":"Introducing ScenarioTests, an experiment in improving the .NET testing experience","description":"When developing software, you\u0026rsquo;ll sooner or later be confronted with the notion of Tests. In the .NET landscape we have plenty of tools at our disposal to help us test our code. In this post I\u0026rsquo;d like to introduce ScenarioTests. A new project that aims to make testing in .NET better.\n","inLanguage":"en","wordCount":1659,"datePublished":"2021-05-03T00:00:00","dateModified":"2021-05-03T00:00:00","image":"https:\/\/www.onthedrift.com\/img\/avatar-squared-nobody.png","keywords":[".NET, Tests, UnitTests, ScenarioTests"],"mainEntityOfPage":"https:\/\/www.onthedrift.com\/posts\/scenario-tests\/","publisher":{"@type":"Organization","name":"https:\/\/www.onthedrift.com","logo":{"@type":"ImageObject","url":"https:\/\/www.onthedrift.com\/img\/avatar-squared-nobody.png","height":60,"width":60}}}</script>
<meta property="og:title" content="Introducing ScenarioTests, an experiment in improving the .NET testing experience">
<meta property="og:description" content="When developing software, you&rsquo;ll sooner or later be confronted with the notion of Tests. In the .NET landscape we have plenty of tools at our disposal to help us test our code. In this post I&rsquo;d like to introduce ScenarioTests. A new project that aims to make testing in .NET better.">
<meta property="og:image" content="https://www.onthedrift.com/img/avatar-squared-nobody.png">
<meta property="og:url" content="https://www.onthedrift.com/posts/scenario-tests/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="On The Drift">
<meta name=twitter:title content="Introducing ScenarioTests, an experiment in improving the .NET testing …">
<meta name=twitter:description content="When developing software, you&rsquo;ll sooner or later be confronted with the notion of Tests. In the .NET landscape we have plenty of tools at our disposal to help us test our code. In this post …">
<meta name=twitter:image content="https://www.onthedrift.com/img/avatar-squared-nobody.png">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@onthedrift2">
<meta name=twitter:creator content="@onthedrift2">
<link href=https://www.onthedrift.com/img/avatar-squared-nobody.ico rel=icon type=image/x-icon>
<meta name=generator content="Hugo 0.86.1">
<link rel=alternate href=https://www.onthedrift.com/index.xml type=application/rss+xml title="On The Drift"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://www.onthedrift.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">
<link rel=stylesheet href=https://www.onthedrift.com/css/highlight.min.css><link rel=stylesheet href=https://www.onthedrift.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://www.onthedrift.com>On The Drift</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title=Blog href=/>Blog</a>
</li>
<li>
<a title=Tags href=/tags>Tags</a>
</li>
</ul>
</div>
<div class=avatar-container>
<div class=avatar-img-border>
<a title="On The Drift" href=https://www.onthedrift.com>
<img class=avatar-img src=https://www.onthedrift.com/img/avatar-squared-nobody.png alt="On The Drift">
</a>
</div>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=posts-heading>
<h1>Introducing ScenarioTests, an experiment in improving the .NET testing experience</h1>
<hr class=small>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<p>When developing software, you&rsquo;ll sooner or later be confronted with the notion of Tests. In the .NET landscape we have plenty of <a href=https://docs.microsoft.com/en-us/dotnet/core/testing/>tools</a> at our disposal to help us test our code. In this post I&rsquo;d like to introduce <a href=https://github.com/koenbeuk/ScenarioTests>ScenarioTests</a>. A new project that aims to make testing in .NET better.</p>
<p>Before talking about what ScenarioTests are, lets first describe a common approach for testing our code currently. Let&rsquo;s imagine that we&rsquo;re implementing a Stack datatype and we now want to prove that we can Push something on our stack:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=na>[Fact]</span>
<span class=k>void</span> <span class=n>Push_IncreasesStackCount</span><span class=p>(){</span>
    <span class=c1>// arrange
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span> <span class=c1>// Subject here is the what we&#39;re testing against
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Count</span><span class=p>);</span> <span class=c1>// Convenient but bad... read on
</span><span class=c1></span>
    <span class=c1>// act
</span><span class=c1></span>    <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>1</span><span class=p>);</span> <span class=c1>// We push something on the stack
</span><span class=c1></span>
    <span class=c1>// assert
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Count</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>This follows a typical arrange/act/assert pattern wherein our arrange step we can set up a scenario, we then act on that scenario in our act step and finally we assert that our state is as we were expecting. We actually did something else. We had an initial assertion in our arrange step to ensure that we started out with an initial count of 0.</p>
<p>Doing multiple assertions- or rather, asserting different and subsequently evolving cases within a single test is typically discouraged. The problem with this approach is that If my initial count was not 0 but let&rsquo;s say NULL (since nothing was yet pushed to the Stack) then my entire test would have failed including the Assertion that indeed pushing in 1 item would set the Stack count to 1. Instead, I should have written 2 test methods:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=na>[Fact]</span>
<span class=k>void</span> <span class=n>StartsWithACountOf0</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// act
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span> 
    
    <span class=c1>// assert
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Count</span><span class=p>);</span> 
<span class=p>}</span>
<span class=na>
</span><span class=na>[Fact]</span>
<span class=k>void</span> <span class=n>Push_IncreasesStackCount</span><span class=p>(){</span>
    <span class=c1>// arrange
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>

    <span class=c1>// act
</span><span class=c1></span>    <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>

    <span class=c1>// assert
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Count</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>Okay, that&rsquo;s more code to write but at least we&rsquo;re clean now. Lets add another test case:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=na>[Fact]</span>
<span class=k>void</span> <span class=n>StartsWithASizeOf0</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// act
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span> 
    
    <span class=c1>// assert
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span> 
<span class=p>}</span>
<span class=na>
</span><span class=na>[Fact]</span>
<span class=k>void</span> <span class=n>Push_IncreasesStackSize</span><span class=p>(){</span>
    <span class=c1>// arrange
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>

    <span class=c1>// act
</span><span class=c1></span>    <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>

    <span class=c1>// assert
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span>
<span class=p>}</span>
<span class=na>
</span><span class=na>
</span><span class=na>[Fact]</span>
<span class=k>void</span> <span class=n>Pop_StackWith1Item_DecreasesStackSize</span><span class=p>(){</span>
    <span class=c1>// arrange
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>
    <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>

    <span class=c1>// act
</span><span class=c1></span>    <span class=n>subject</span><span class=p>.</span><span class=n>Pop</span><span class=p>();</span>

    <span class=c1>// assert
</span><span class=c1></span>    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>This is getting repetitive. Each additional test seems to be repeating what the previous test was doing while building on top of it. This gets worse when working with end-to-end testing where you actually test the <a href=https://conductofcode.io/post/bdd-frameworks-for-dotnet-csharp/>behavior</a> of a system:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=k>public</span> <span class=k>void</span> <span class=n>Ensure_That_Item_Was_Ordered_For_New_User</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// Arrange
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>server</span> <span class=p>=</span> <span class=n>CreateTestServer</span><span class=p>();</span>
    
    <span class=kt>var</span> <span class=n>productId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateProduct</span><span class=p>(</span><span class=k>new</span> <span class=n>Product</span> <span class=p>{</span> <span class=p>...</span> <span class=p>});</span>
    <span class=kt>var</span> <span class=n>shoppingCartId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateShoppingCart</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span>
    <span class=kt>var</span> <span class=n>userId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateUser</span><span class=p>(</span><span class=k>new</span> <span class=n>User</span> <span class=p>{</span> <span class=p>});</span>
    <span class=n>server</span><span class=p>.</span><span class=n>AssignCartToUser</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span> <span class=n>shoppingCartId</span><span class=p>)</span>    
    <span class=n>server</span><span class=p>.</span><span class=n>AddProductInCart</span><span class=p>(</span><span class=n>productId</span><span class=p>,</span> <span class=m>1</span><span class=p>);</span>

    <span class=c1>// Act
</span><span class=c1></span>    <span class=n>server</span><span class=p>.</span><span class=n>OrderCartContent</span><span class=p>(</span><span class=n>shoppingCartId</span><span class=p>);</span>

    <span class=c1>// Assert
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>order</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>GetLastOrder</span><span class=p>();</span>
    <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>shoppingCartId</span><span class=p>,</span> <span class=n>order</span><span class=p>.</span><span class=n>ShoppingCartId</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>Imagine having to write a second test that ensures that the order got shipped out. It would be a whole lot of repetition to get to a basic state and then some additional assertion. Yes, you could and probably should wrap up some of the arrangement steps in helper methods but that will only save you soo much&mldr; (I ran into this exact same issue when testing a service manipulating and querying a <a href=https://tinkerpop.apache.org/gremlin.html>Gremlin</a> enabled database).</p>
<p>If I was to &lsquo;hack&rsquo; this Server in an afternoon, I would typically not bother testing it and rather just implement a console application that would then play out a Scenario and I would make use of <code>Console.WriteLine</code> and the debugger to ensure that things are working as expected. A typical example would look just like you&rsquo;d expect:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=k>async</span> <span class=n>Task</span> <span class=n>Main</span><span class=p>()</span> <span class=p>{</span>
    <span class=kt>var</span> <span class=n>server</span> <span class=p>=</span> <span class=n>CreateTestServer</span><span class=p>();</span>
    <span class=kt>var</span> <span class=n>productId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateProduct</span><span class=p>(</span><span class=k>new</span> <span class=n>Product</span> <span class=p>{</span> <span class=p>...</span> <span class=p>});</span>
    <span class=kt>var</span> <span class=n>userId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateUser</span><span class=p>(</span><span class=k>new</span> <span class=n>User</span> <span class=p>{</span> <span class=p>});</span>
    <span class=kt>var</span> <span class=n>shoppingCartId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateShoppingCart</span><span class=p>(</span><span class=n>userId</span><span class=p>);</span>
    <span class=n>server</span><span class=p>.</span><span class=n>AssignCartToUser</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span> <span class=n>shoppingCartId</span><span class=p>)</span>    
    <span class=n>server</span><span class=p>.</span><span class=n>AddProductInCart</span><span class=p>(</span><span class=n>productId</span><span class=p>,</span> <span class=m>1</span><span class=p>);</span>
    <span class=kt>var</span> <span class=n>order</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>GetLastOrder</span><span class=p>();</span>
    <span class=kt>var</span> <span class=n>paymentId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CapturePayment</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=n>Id</span><span class=p>);</span>
    <span class=kt>var</span> <span class=n>payment</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>GetPayment</span><span class=p>(</span><span class=n>paymentId</span><span class=p>);</span>
    <span class=kt>var</span> <span class=n>shippingNumber</span> <span class=p>=</span> <span class=n>shippingService</span><span class=p>.</span><span class=n>Send</span><span class=p>(</span><span class=n>order</span><span class=p>.</span><span class=n>Id</span><span class=p>);</span>

    <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;Shipped your order with number {shippingNumber}&#34;</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>Because I have the debugger at my disposal, I can simply intercept any step and do manual assertion (that is checking if states were updated as I would have expected them to be). This console application example is an example of why <a href=https://en.wikipedia.org/wiki/Behavior-driven_development>behavior driven development</a> (BDD for short) is a thing. BDD uses human readable descriptions of software user requirements. In my example, this description is implemented in C# since that is the language that I speak.</p>
<h3 id=introducing-scenariotests>Introducing ScenarioTests</h3>
<p>With <a href=https://github.com/koenbeuk/ScenarioTests>ScenarioTests</a> I started an experiment to see if we can combine best of all worlds, that is:</p>
<ol>
<li>Let me express a scenario from start to finish using a language that I&rsquo;m comfortable in (in this case C#)</li>
<li>Let me add assertions along the way testing the current state of that scenario</li>
<li>Let me branch out (e.g. use a non-existing UserID and assert how the subject should react if that was the case)</li>
</ol>
<p>After prototyping a few ideas, I came up with a solution that reuses what we&rsquo;re already familiar with (in this case XUnit) while allowing the above 3 points to be met. As an example of our custom Stack sample introduced earlier in this post:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=na>[Scenario]</span>
<span class=k>public</span> <span class=k>void</span> <span class=n>Scenario</span><span class=p>(</span><span class=n>ScenarioContext</span> <span class=n>scenario</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// We create a subject as we would normally do
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>subject</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stack</span><span class=p>&lt;</span><span class=kt>int</span><span class=p>&gt;();</span>
     
    <span class=c1>// Lets define our first test case, we want to ensure that our stack starts out with a Size of 0
</span><span class=c1></span>    <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;Starts with a size of 0&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span>
    <span class=p>});</span>
   
    <span class=c1>// Lets progress our scenario, lets add something to the stack
</span><span class=c1></span>    <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>

    <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;Push increased stack size by 1&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span>
    <span class=p>});</span>

    <span class=c1>// Lets see if we can pop our stack
</span><span class=c1></span>    <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;We can pop our single item and end up with an empty stack&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;{</span>
        <span class=n>subject</span><span class=p>.</span><span class=n>Pop</span><span class=p>();</span>
        <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span>
    <span class=p>});</span>
 
    <span class=c1>// Lets push something else and ensure that the stack is growing accordingly
</span><span class=c1></span>    <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>2</span><span class=p>);</span>
    <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;We should now have 2 items on our stack&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=m>2</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Size</span><span class=p>);</span>
    <span class=p>});</span>
<span class=p>}</span>
</code></pre></div><p>And what you would see in VS:
<img src=vscapture1.png alt="VS2019 Test explorer output" title="VS2019 Test explorer output"></p>
<p>What happened here? We expressed a scenario that essentially creates an empty stack, pushes an item, and then pushes a second item. Along the way we were able to add tests and assert facts about our subjects state as it was at that stage in the Scenario. If you looked closely you would have seen that we actually manipulated our stack and Popped an item in one of our Tests. This however did not affect the subsequent tests in our scenario since it was encapsulated within that test. How did that work?</p>
<p><code>ScenarioTests</code> uses a source generator to generate XUnit test methods for each invocation of <code>Assert</code> or <code>Theory</code> on the <code>ScenarioContext</code> that got passed in as an argument. That test method is then configured to run our Scenario while ending as soon as it hits a conclusion for that particular test. In the case of our <code>Starts with a size of 0</code> test. It would end the scenario right after it was able to assert that the stack started with a size of 0.</p>
<p>Even if we were to throw an exception right in the middle of this Scenario, tests running before that exception will still pass. If we were to throw an exception in our first test then any other test would not be affected. Because of this logic, we can even manipulate our subject within one of our test methods as demonstrated by our Pop call in one of our tests and still have confidence that the manipulation does not affect subsequent tests.</p>
<p>This is all great but what about dealing with Theories. I like to describe a theory in XUnit as something that should be true for at least the input that I&rsquo;ve given it. Let&rsquo;s say we wanted to continue our scenario and make sure that we can push many items onto our stack while still having the count go up accordingly, we can do just that:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp>    <span class=c1>// Continuing from where we left off, at this stage our stack contains 2 numbers
</span><span class=c1></span>    <span class=kt>var</span> <span class=n>theoryCases</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>int</span><span class=p>[]</span> <span class=p>{</span> <span class=m>0</span><span class=p>,</span> <span class=m>1</span><span class=p>,</span> <span class=m>2</span><span class=p>,</span> <span class=m>4</span><span class=p>,</span> <span class=m>8</span><span class=p>,</span> <span class=m>16</span><span class=p>,</span> <span class=m>1024</span> <span class=p>};</span>
    <span class=kt>var</span> <span class=n>initialStackSize</span> <span class=p>=</span> <span class=n>subject</span><span class=p>.</span><span class=n>Count</span><span class=p>;</span> <span class=c1>// Capture what we already had in the stack
</span><span class=c1></span>
    <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>numbersToAdd</span> <span class=k>in</span> <span class=n>theoryCases</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>scenario</span><span class=p>.</span><span class=n>Theory</span><span class=p>(</span><span class=s>&#34;We can add X items and still satisfy our count property&#34;</span><span class=p>,</span> <span class=n>numbersToAdd</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>var</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=n>numbersToAdd</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span> <span class=p>{</span>
                <span class=n>subject</span><span class=p>.</span><span class=n>Push</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>
            <span class=p>}</span>

            <span class=n>Assert</span><span class=p>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>initialStackSize</span> <span class=p>+</span> <span class=n>numbersToAdd</span><span class=p>,</span> <span class=n>subject</span><span class=p>.</span><span class=n>Count</span><span class=p>);</span>
        <span class=p>});</span>
    <span class=p>}</span>
</code></pre></div><p>And what we would see in VS:
<img src=vscapture2.png alt="VS2019 Test explorer output" title="VS2019 Test explorer output"></p>
<p>Again we made use of the fact that tests run in isolation. Each theory case is manipulating the state of our Stack however it does not affect or gets affected by other Theory cases. This works since the Scenario is replayed for each theory case. So what would a typical end-to-end scenario look like:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=na>[Scenario]</span>
<span class=k>void</span> <span class=n>Scenario</span><span class=p>(</span><span class=n>ScenarioContext</span> <span class=n>scenario</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Imagine that this scenario requires some docker containers
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(!</span><span class=n>DockerDetector</span><span class=p>.</span><span class=n>IsDockerAvailable</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>scenario</span><span class=p>.</span><span class=n>Skip</span><span class=p>(</span><span class=s>&#34;Docker is required for this scenario&#34;</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// Lets start our server
</span><span class=c1></span>        <span class=kt>var</span> <span class=n>server</span> <span class=p>=</span> <span class=n>CreateTestServer</span><span class=p>();</span>
        <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;Server is valid&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Assert</span><span class=p>.</span><span class=n>True</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>IsValid</span><span class=p>));</span>

        <span class=c1>//  And lets create a product
</span><span class=c1></span>        <span class=kt>var</span> <span class=n>productId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateProduct</span><span class=p>(</span><span class=k>new</span> <span class=n>Product</span> <span class=p>{</span> <span class=p>...</span> <span class=p>});</span>
        <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;ProductId is not null&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Assert</span><span class=p>.</span><span class=n>NotNull</span><span class=p>(</span><span class=n>productId</span><span class=p>));</span>
        <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;We can fetch our product&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=kt>var</span> <span class=n>product</span> <span class=p>=</span> <span class=k>await</span> <span class=n>server</span><span class=p>.</span><span class=n>GetProduct</span><span class=p>(</span><span class=n>productId</span><span class=p>);</span>
            <span class=n>Assert</span><span class=p>.</span><span class=n>NotNull</span><span class=p>(</span><span class=n>product</span><span class=p>);</span>
        <span class=p>});</span>

        <span class=c1>// We also need a sample user
</span><span class=c1></span>        <span class=kt>var</span> <span class=n>userId</span> <span class=p>=</span> <span class=n>server</span><span class=p>.</span><span class=n>CreateUser</span><span class=p>(</span><span class=k>new</span> <span class=n>User</span> <span class=p>{</span> <span class=p>});</span>
        <span class=n>scenario</span><span class=p>.</span><span class=n>Fact</span><span class=p>(</span><span class=s>&#34;userId is not null&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=n>Assert</span><span class=p>.</span><span class=n>NotNull</span><span class=p>(</span><span class=n>userId</span><span class=p>));</span>

        <span class=c1>// Skipped the rest of the implement for brevity   
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>As expected we are able to write down our scenario in our DSL of choice which happens to be C#. We even introduced a check to see if Docker is available to us as our imaginary server would need it. We then properly skip tests if Docker is not available.</p>
<h3 id=conclusion>Conclusion</h3>
<p>With ScenarioTests you can express your scenario in C# while testing along the way. ScenarioTests are currently in an experimental phase. You can find the project on <a href=https://github.com/koenbeuk/ScenarioTests>Github</a>
And pull it directly from <a href=https://www.nuget.org/packages/ScenarioTests.XUnit/>NuGet</a></p>
<p>More samples are available on <a href=https://github.com/koenbeuk/ScenarioTests/tree/master/samples>Github</a> and in a separate <a href=https://github.com/koenbeuk/SampleApiE2ETests>E2E test demo project</a></p>
<div class=blog-tags>
<a href=https://www.onthedrift.com/tags/.net/>.NET</a>&nbsp;
<a href=https://www.onthedrift.com/tags/tests/>Tests</a>&nbsp;
<a href=https://www.onthedrift.com/tags/unittests/>UnitTests</a>&nbsp;
<a href=https://www.onthedrift.com/tags/scenariotests/>ScenarioTests</a>&nbsp;
</div>
<hr>
<section id=social-share>
<div class="list-inline footer-links">
<div class=share-box aria-hidden=true>
<ul class=share>
<li>
<a href="//twitter.com/share?url=https%3a%2f%2fwww.onthedrift.com%2fposts%2fscenario-tests%2f&text=Introducing%20ScenarioTests%2c%20an%20experiment%20in%20improving%20the%20.NET%20testing%20experience&via=onthedrift2" target=_blank title="Share on Twitter">
<i class="fab fa-twitter"></i>
</a>
</li>
<li>
<a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.onthedrift.com%2fposts%2fscenario-tests%2f" target=_blank title="Share on Facebook">
<i class="fab fa-facebook"></i>
</a>
</li>
<li>
<a href="//reddit.com/submit?url=https%3a%2f%2fwww.onthedrift.com%2fposts%2fscenario-tests%2f&title=Introducing%20ScenarioTests%2c%20an%20experiment%20in%20improving%20the%20.NET%20testing%20experience" target=_blank title="Share on Reddit">
<i class="fab fa-reddit"></i>
</a>
</li>
<li>
<a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.onthedrift.com%2fposts%2fscenario-tests%2f&title=Introducing%20ScenarioTests%2c%20an%20experiment%20in%20improving%20the%20.NET%20testing%20experience" target=_blank title="Share on LinkedIn">
<i class="fab fa-linkedin"></i>
</a>
</li>
<li>
<a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fwww.onthedrift.com%2fposts%2fscenario-tests%2f&title=Introducing%20ScenarioTests%2c%20an%20experiment%20in%20improving%20the%20.NET%20testing%20experience" target=_blank title="Share on StumbleUpon">
<i class="fab fa-stumbleupon"></i>
</a>
</li>
<li>
<a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.onthedrift.com%2fposts%2fscenario-tests%2f&description=Introducing%20ScenarioTests%2c%20an%20experiment%20in%20improving%20the%20.NET%20testing%20experience" target=_blank title="Share on Pinterest">
<i class="fab fa-pinterest"></i>
</a>
</li>
</ul>
</div>
</div>
</section>
<h4 class=see-also>See also</h4>
<ul>
<li><a href=/posts/efcore-projectables-perf/>EFCore.Projectables and the curious case of an unexpected performance boost</a></li>
<li><a href=/posts/efcore-projectables/>EF Projections on computed properties and methods without a hassle!</a></li>
<li><a href=/posts/efcore-triggered-part1/>Triggers for Entity Framework Core</a></li>
<li><a href=/posts/activator-utilities/>Activator utilities: activate anything!</a></li>
</ul>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://www.onthedrift.com/posts/efcore-triggered-part1/ data-toggle=tooltip data-placement=top title="Triggers for Entity Framework Core">&larr; Previous Post</a>
</li>
<li class=next>
<a href=https://www.onthedrift.com/posts/efcore-projectables/ data-toggle=tooltip data-placement=top title="EF Projections on computed properties and methods without a hassle!">Next Post &rarr;</a>
</li>
</ul>
<div class=disqus-comments>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//onthedrift.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=mailto:koen@linker.io title="Email me">
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://github.com/koenbeuk title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://twitter.com/onthedrift2 title=Twitter>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://stackoverflow.com/users/272424/polity title=StackOverflow>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href title=RSS>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
<a href=https://www.onthedrift.com>Koen</a>
&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://www.onthedrift.com>On The Drift</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.86.1</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
&nbsp;&bull;&nbsp;[<a href=https://github.com/koenbeuk/onthedrift/tree/bc21cfb4c331d0184e1f0c9f6e70d2a9e82757d1>bc21cfb4</a>]
</p>
</div>
</div>
</div>
</footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://www.onthedrift.com/js/main.js></script>
<script src=https://www.onthedrift.com/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.onthedrift.com/js/load-photoswipe.js></script>
<script type=text/javascript>!function(b,d,a){var e=b.location,o="script",n="instrumentationKey",g="ingestionendpoint",k="disableExceptionTracking",i="ai.device.",j="toLowerCase",h="crossOrigin",l="POST",m="appInsightsSDK",f=a.name||"appInsights",c;(a.name||b[m])&&(b[m]=f),c=b[f]||function(f){var z=!1,q=!1,c={initialize:!0,queue:[],sv:"5",version:2,config:f},r,s,m,x,y,B,p,A;function w(b,f){var a={},d="Browser";return a[i+"id"]=d[j](),a[i+"type"]=d,a["ai.operation.name"]=e&&e.pathname||"_unknown_",a["ai.internal.sdkVersion"]="javascript:snippet_"+(c.sv||c.version),{time:function(){var a=new Date;function b(b){var a=""+b;return 1===a.length&&(a="0"+a),a}return a.getUTCFullYear()+"-"+b(1+a.getUTCMonth())+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+((a.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:b,name:"Microsoft.ApplicationInsights."+b.replace(/-/g,"")+"."+f,sampleRate:100,tags:a,data:{baseData:{ver:2}}}}if(r=f.url||a.src,r){function u(x){var h,i,t,u,v,s,o,p,k,d,m;z=!0,c.queue=[],q||(q=!0,h=r,o=function(){var a={},d=f.connectionString,e,b,c,h,i;if(d)for(e=d.split(";"),b=0;b<e.length;b++)c=e[b].split("="),2===c.length&&(a[c[0][j]()]=c[1]);return a[g]||(h=a.endpointsuffix,i=h?a.location:null,a[g]="https://"+(i?i+".":"")+"dc."+(h||"services.visualstudio.com")),a}(),p=o[n]||f[n]||"",k=o[g],d=k?k+"/v2/track":f.endpointUrl,(m=[]).push((i="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",t=h,u=d,(s=(v=w(p,"Exception")).data).baseType="ExceptionData",s.baseData.exceptions=[{typeName:"SDKLoadFailed",message:i.replace(/\./g,"-"),hasFullStack:!1,stack:i+"\nSnippet failed to load ["+t+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(e&&e.pathname||"_unknown_")+"\nEndpoint: "+u,parsedStack:[]}],v)),m.push(function(g,f,d,e){var b=w(p,"Message"),c=b.data,a;return c.baseType="MessageData",a=c.baseData,a.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+d+")").replace(/\"/g,"")+'"',a.properties={endpoint:e},b}(0,0,h,d)),function(e,f){var d,c;JSON&&(d=b.fetch,d&&!a.useXhr?d(f,{method:l,body:JSON.stringify(e),mode:"cors"}):XMLHttpRequest&&(c=new XMLHttpRequest,c.open(l,f),c.setRequestHeader("Content-type","application/json"),c.send(JSON.stringify(e))))}(m,d))}function t(b,a){q||setTimeout(function(){!a&&c.core||u()},500)}s=function(){var b=d.createElement(o),c;return b.src=r,c=a[h],!c&&""!==c||"undefined"==b[h]||(b[h]=c),b.onload=t,b.onerror=u,b.onreadystatechange=function(c,a){"loaded"!==b.readyState&&"complete"!==b.readyState||t(0,a)},b}(),a.ld<0?d.getElementsByTagName("head")[0].appendChild(s):setTimeout(function(){d.getElementsByTagName(o)[0].parentNode.appendChild(s)},a.ld||0)}try{c.cookie=d.cookie}catch(a){}function v(a){for(;a.length;)!function(a){c[a]=function(){var b=arguments;z||c.queue.push(function(){c[a].apply(c,b)})}}(a.pop())}return m="track",x="TrackPage",y="TrackEvent",v([m+"Event",m+"PageView",m+"Exception",m+"Trace",m+"DependencyData",m+"Metric",m+"PageViewPerformance","start"+x,"stop"+x,"start"+y,"stop"+y,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),c.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4},B=(f.extensionConfig||{}).ApplicationInsightsAnalytics||{},!0!==f[k]&&!0!==B[k]&&(p="onerror",v(["_"+p]),A=b[p],b[p]=function(a,b,d,e,f){var g=A&&A(a,b,d,e,f);return!0!==g&&c["_"+p]({message:a,url:b,lineNumber:d,columnNumber:e,error:f}),g},f.autoExceptionInstrumented=!0),c}(a.cfg);function p(){a.onInit&&a.onInit(c)}(b[f]=c).queue&&0===c.queue.length?(c.queue.push(p),c.trackPageView({})):p()}(window,document,{src:"https://js.monitor.azure.com/scripts/b/ai.2.min.js",crossOrigin:"anonymous",cfg:{connectionString:"InstrumentationKey=cfd015d4-8126-4254-bc26-a6a73ad5d6d0;IngestionEndpoint=https://westus2-0.in.applicationinsights.azure.com/"}})</script>
</body>
</html>